name: build

on:  
  push:
    paths-ignore:
    - "README.md"
    - "docs/**"
    branches:
    - main

jobs:
  build:
    runs-on: self-hosted
    steps:
    - uses: actions/checkout@v2

    - name: BOSS Update packages
      run: boss update

    - name: Creating output folders
      run: |
        mkdir bin
        mkdir bin/linux
        mkdir bin/linux/tests
        mkdir bin/windows
        mkdir bin/windows/tests
        mkdir bin/macos
        mkdir bin/macos/tests
        
    - name: Building & testing (Linux)
      run: |
        echo "building main application..."
        ~/laz-222/lazarus/lazbuild "pasc.lpi" --build-mode=Release
        cp ./pasc ./bin/linux/pasc
        echo "building tests"
        ~/laz-222/lazarus/lazbuild "tests/TestPasc.lpi"
        echo "running tests and change the current folder"
        ./tests/TestPasc "--all" "--format=plain"
